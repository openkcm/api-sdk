syntax = "proto3";

package kms.api.cmk.registry.auth.v1;

import "google/api/annotations.proto";

service Service {
  rpc ApplyAuth(ApplyAuthRequest) returns (ApplyAuthResponse) {
    option (google.api.http) = {
      post: "/v1/auth"
      body: "*"
    };
  }
  rpc GetAuth(GetAuthRequest) returns (GetAuthResponse) {
    option (google.api.http) = {
      get: "/v1/auth/{external_id}"
    };
  }
  rpc ListAuths(ListAuthsRequest) returns (ListAuthsResponse) {
    option (google.api.http) = {
      get: "/v1/auths"
    };
  }
  rpc RemoveAuth(RemoveAuthRequest) returns (RemoveAuthResponse) {
    option (google.api.http) = {
      delete: "/v1/auth/{external_id}"
    };
  }
}

message Auth {
  string external_id = 1;
  string tenant_id = 2;
  string type = 3;
  map<string, string> properties = 4;
  AuthStatus status = 5;
  string error_message = 6;
  string updated_at = 7;
  string created_at = 8;
}

message ApplyAuthRequest {
  string external_id = 1;
  string tenant_id = 2;
  string type = 3;
  map<string, string> properties = 4;
}

message ApplyAuthResponse {
  bool success = 1;
}

message GetAuthRequest {
  string external_id = 1;
}

message GetAuthResponse {
  Auth auth = 1;
}

message ListAuthsRequest {
  string tenant_id = 1;

  int32 limit = 2; // default value is 50; max value is 1000
  string next_page_token = 3;
}

message ListAuthsResponse {
  repeated Auth auth = 1;

  string next_page_token = 2;
}

message RemoveAuthRequest {
  string external_id = 1;
}

message RemoveAuthResponse {
  bool success = 1;
}

enum AuthStatus {
  AUTH_STATUS_UNSPECIFIED = 0;
  AUTH_STATUS_APPLYING = 1;
  AUTH_STATUS_APPLYING_ERROR = 2;
  AUTH_STATUS_APPLIED = 3;
  AUTH_STATUS_REMOVING = 4;
  AUTH_STATUS_REMOVING_ERROR = 5;
  AUTH_STATUS_REMOVED = 6;
}

enum AuthAction {
  AUTH_ACTION_UNSPECIFIED = 0;
  AUTH_ACTION_APPLY_AUTH = 1;
  AUTH_ACTION_REMOVE_AUTH = 2;
}
